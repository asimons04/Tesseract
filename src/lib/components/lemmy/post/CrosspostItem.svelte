<script lang="ts">
    import type { PostView } from 'lemmy-js-client';

    import { getInstance } from '$lib/lemmy.js'
    import { userSettings } from '$lib/settings'

    import CommunityLink from '$lib/components/lemmy/community/CommunityLink.svelte'
    import FormattedNumber from '$lib/components/util/FormattedNumber.svelte'
    import RelativeDate from '$lib/components/util/RelativeDate.svelte'

    import {
        Icon,
        ArrowUp,
        ArrowDown,
        ChatBubbleOvalLeftEllipsis,
        Pencil
    } from 'svelte-hero-icons'
    import UserLink from '../user/UserLink.svelte';

    export let crosspost:PostView;
    export let textSize:string = "text-xs"
    export let iconSize:number = 18
    export let showUser:boolean = false
    export let showTitle:boolean = false


    const getTextSize = () => `text-xs md:${textSize}`

</script>


<a class="flex flex-col gap-1 items-start
        hover:dark:bg-zinc-800 hover:bg-slate-200
        py-2.5 px-4 
        {getTextSize()}
    " 
    id="{crosspost.post.id.toString()}"
    href="/post/{getInstance()}/{crosspost.post.id}" title="{crosspost.post.name}"
>
    
    <div class="flex flex-col w-full gap-1">
        {#if showTitle}
            <span class="font-bold truncate">{crosspost.post.name}</span>
        {/if}

        <div class="flex flex-row w-full items-center">
            <div class="flex flex-col lg:flex-row gap-1">
                <CommunityLink community={crosspost.community} avatar avatarSize={iconSize}/>
                {#if showUser}
                    <span> by <UserLink user={crosspost.creator} avatar={false} /></span>
                {/if}
            </div>

            <div class="flex flex-row min-w-fit gap-1 ml-auto">
                <span class="hidden md:flex flex-row gap-1 items-center text-slate-600 dark:text-zinc-400">
                    <RelativeDate date={crosspost.post.published} />
                    {#if crosspost.post.updated}
                        <span class="flex flex-row items-center gap-1 ml-1">â€¢
                            <Icon src={Pencil} solid size="12" title="Edited" />
                            <RelativeDate date={crosspost.post.updated}/>
                        </span>
                    {/if}
                </span>
        
                {#if $userSettings.uiState.showScores}
                <span class="flex flex-row gap-2 font-normal items-center">
                    <Icon src={crosspost.counts.score > 0 ? ArrowUp : ArrowDown} mini width={iconSize} height={iconSize}/>
                    <FormattedNumber number={crosspost.counts.score} />
                </span>
                {/if}
        
            
                <span class="flex flex-row gap-2 font-normal items-center" >
                    <Icon src={ChatBubbleOvalLeftEllipsis} mini width={iconSize} height={iconSize}/>
                    <FormattedNumber number={crosspost.counts.comments} />
                </span>
            </div>

        </div>
    </div>
    
    
</a>